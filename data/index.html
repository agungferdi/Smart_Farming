<!DOCTYPE html>
<html>
<head>
    <title>ESP32 LED Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="container">
        <h1>ESP32 LED Control</h1>
        <div class="status-container">
            <p>LED Status: <span id="ledStatus">OFF</span></p>
            <div class="led-indicator" id="ledIndicator"></div>
        </div>
        <button id="toggleBtn" class="btn">Turn ON</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toggleBtn = document.getElementById('toggleBtn');
            const ledStatus = document.getElementById('ledStatus');
            const ledIndicator = document.getElementById('ledIndicator');
            let isOn = false;

            // Initial state update
            updateStatus();

            // Check the current state when page loads
            fetchLedState();

            toggleBtn.addEventListener('click', function() {
                isOn = !isOn;
                
                // Send command to server
                fetch('/toggle')
                    .then(response => response.text())
                    .then(state => {
                        isOn = (state === "1");
                        updateStatus();
                    })
                    .catch(error => console.error('Error:', error));
            });

            function updateStatus() {
                if (isOn) {
                    ledStatus.textContent = "ON";
                    ledStatus.className = "on";
                    ledIndicator.className = "led-indicator on";
                    toggleBtn.textContent = "Turn OFF";
                } else {
                    ledStatus.textContent = "OFF";
                    ledStatus.className = "off";
                    ledIndicator.className = "led-indicator off";
                    toggleBtn.textContent = "Turn ON";
                }
            }

            function fetchLedState() {
                fetch('/state')
                    .then(response => response.text())
                    .then(state => {
                        isOn = (state === "1");
                        updateStatus();
                    })
                    .catch(error => console.error('Error:', error));
            }
        });
    </script>
</body>
</html>
