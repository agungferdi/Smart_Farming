generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model SensorData {
  id               BigInt     @id @default(autoincrement())
  /// Temperature reading from DHT11 sensor in Celsius
  temperature      Decimal    @db.Decimal(5, 2)
  /// Humidity reading from DHT11 sensor in percentage
  humidity         Decimal    @db.Decimal(5, 2)
  /// Soil moisture reading in percentage (0-100%)
  soilMoisture     Int        @map("soil_moisture")
  /// Soil temperature reading from DS18B20 sensor in Celsius
  soilTemperature  Decimal?   @db.Decimal(5, 2) @map("soil_temperature")
  /// Rain detection status from MH-RD sensor
  rainDetected     Boolean    @map("rain_detected")
  /// Water level classification: "Low", "Medium", or "High"
  waterLevel       String     @map("water_level")
  createdAt        DateTime?  @default(now()) @db.Timestamptz(6) @map("created_at")
  relayLogs        RelayLog[]

  @@index([createdAt(sort: Desc)], map: "idx_sensor_data_created_at")
  @@index([soilMoisture], map: "idx_sensor_data_soil_moisture")
  @@index([soilTemperature], map: "idx_sensor_data_soil_temperature")
  @@map("sensor-data")
}

model RelayLog {
  id               BigInt     @id @default(autoincrement())
  /// Relay status: true = ON (pump active), false = OFF (pump inactive)
  relayStatus      Boolean    @map("relay_status")
  /// Reason for relay state change
  triggerReason    String     @map("trigger_reason")
  /// Foreign key to sensor data reading
  sensorReadingId  BigInt     @map("sensor_reading_id")
  createdAt        DateTime?  @default(now()) @db.Timestamptz(6) @map("created_at")
  sensorData       SensorData @relation(fields: [sensorReadingId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_sensor_reading")

  @@index([createdAt(sort: Desc)], map: "idx_relay_log_created_at")
  @@index([relayStatus], map: "idx_relay_log_status")
  @@index([sensorReadingId], map: "idx_relay_log_sensor_reading")
  @@map("relay-log")
}

